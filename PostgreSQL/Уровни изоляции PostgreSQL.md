# Уровни изоляции PostgreSQL

| №  | Уровень             | Область видимости снимка данных | Описание
| :- | :------------------ | :-------------------------------| :-------
| 1  | ~~Read uncommited~~ | Строка таблицы | Можно увидеть изменения незавершённых транзакций.<br /> Уровень отсутствует в PostgreSQL.
| 2  | Read commited       | Запрос         | Можно увидеть изменения только завершённых транзакций
| 3  | Repeatable read     | Транзакция     | То, что прочитано однажды, будет прочитано ещё раз
| 4  | Serializable        | Транзакция     | Полная иллюзия последовательного выполнения, в частности, отсутствие неожиданно появляющихся строк

# Примеры ошибок read commited

<table>
  <tr>
    <th>Сценарий</th>
    <th>Проблема</th>
    <th>Причина</th>
    <th>Решение</th>
  </tr>
  <tr>
    <td>Комментарии к посту.</td>
    <td>Иногда при добавлении комментария возникает нарушение внешнего ключа.</td>
    <td>Пост был удален после начала транзакции, добавляющей комментарий.</td>
    <td>Варианты:
      <ol>
        <li>Блокировать пост (for share/for update)</li>
        <li>Поставить нужный уровень изоляции</li>
      </ol>
    </td>
  </tr>
  <tr>
    <td>Двойные выплаты. Две таблицы: client(id), client_payment(id, client_id)</td>
    <td>Одному клиенту было направлено две выплаты.</td>
    <td>Две одновременно работающих транзакции не нашли произведенных выплат payment</td>
    <td>Варианты:
      <ol>
        <li>Блокировать клиента (for update/for share)</li>
        <li>Уникальный ключ на client_payment(client_id)</li>
        <li>Поставить нужный уровень изоляции</li>
      </ol>
    </td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
</table>

|  |  | 
